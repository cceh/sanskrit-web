- content_for(:title, 'Cologne Digital Sanskrit Dictionaries (search)')

%h1 Cologne Digital Sanskrit Dictionaries

= form_tag('/dict', method: 'get') do
  %div
    = label_tag(:q, 'term:')
    = text_field_tag(:q, @query[:term])
    - iscripts = options_for_select([['SLP1', :spl1], ['Harvad-Kyoto', :hk], ['Devanagari', :devanagari]])
    = select_tag(:iscript, iscripts)
  %div
    = label_tag(:dict, 'dictionary')
    - dicts = options_for_select([['Monierr-Williams Sanskrit-English', :monier], ['Boehtlingk & Roth Sanskrit-German', :pwg], ['Apte English-Sanskrit', :aptees1]])
    = select_tag(:dict, dicts, multiple: true)
  %div
    = label_tag(:oscript, 'output script')
    - oscripts = options_for_select([['Devanagari only', :devanagari], ['Devanagari + SLP1', :spl1], ['Devanagari + Harvad-Kyoto', :hk]])
    = select_tag(:oscript, oscripts)
  %input(type='submit' value='Search')

- if !@results[:exact].all? { |dict, results| results.empty? }
  %section.results.exact
    %h2 Exact matches
    %details
      - total_results = @results[:exact].map { |d,r| r.count }.inject(&:+)
      %summary= "#{total_results} results"
      - @results[:exact].each do |dict, results|
        %p= "#{results.count} results in #{dict.handle}"
    - @results[:exact].each do |dict, results|
      %div
        %p= "Matches in #{dict.handle}"
        - results.each do |result|
          = render 'entry', :entry => result[:entry], :side_data => result[:side_data]
          = render 'raw_entry', :entry => result[:entry]
    %h3 Adjacent lemmas
    %ul.adjacent
      - @results[:preceding].each do |dict, results|
        - results.each do |result|
          = render 'adjacent_entry', :entry => result[:entry], :side_data => result[:side_data]
      %li.term= "#{@query[:term]}"
      - @results[:following].each do |dict, results|
        - results.each do |result|
          = render 'adjacent_entry', :entry => result[:entry], :side_data => result[:side_data]

- if !@results[:similar].empty?
  %section.results.similar
    %h2 Similar matches
    %details
      - total_results = @results[:similar].map { |d,r| r.count }.inject(&:+)
      %summary= "#{total_results} results"
      - @results[:similar].each do |dict, results|
        %p= "#{results.count} results in #{dict.handle}"
    - @results[:similar].each do |dict, results|
      %div
        %p= "Matches in #{dict.handle}"
        %ul
          - results.each do |result|
            = render 'similar_entry', :entry => result[:entry], :side_data => result[:side_data]
